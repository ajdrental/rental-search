<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>아정당 상품 검색</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: 'Arial', sans-serif; padding: 20px; }
    .search-bar { margin-bottom: 20px; }
    .search-bar input { padding: 8px; width: 300px; }
    .search-bar button { padding: 8px 12px; margin-left: 8px; cursor: pointer; }
    .card { border: 1px solid #ccc; padding: 16px; margin-bottom: 10px; border-radius: 8px; display: flex; gap: 16px; align-items: center; }
    .thumb { width: 100px; height: 100px; object-fit: cover; border: 1px solid #eee; border-radius: 8px; }
    .info { flex: 1; }
    .title { font-size: 18px; font-weight: bold; }
    .model { color: #666; }
    .rent, .policy { margin-top: 4px; }
    .crm-link { margin-top: 8px; display: inline-block; color: #007bff; text-decoration: none; }
  </style>
</head>
<body>
  <h1>아정당 상품 검색</h1>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="상품명 또는 모델명 검색">
    <button onclick="fetchData()">검색</button>
  </div>
  <div id="results"></div>

  <script>
    const sheetID = '14OMmONt1rEvjLlaBBeBHV2NZrusEke-z';
    const sheetName = '01.아정당렌탈 리스트(CS마케팅 공유용)';
    const query = encodeURIComponent('SELECT *');
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}&tq=${query}`;

    function sanitizeURL(url) {
      if (!url) return '';
      return url.includes('http') ? url : `https://${url}`;
    }

    function drawTable(data) {
      const rows = data.table.rows;
      const resultDiv = $('#results');
      resultDiv.empty();
      const keyword = $('#searchInput').val().toLowerCase();

      rows.forEach(row => {
        const 상품명 = row.c[3]?.v || '';
        const 모델명 = row.c[4]?.v || '';
        const 썸네일URL = sanitizeURL(row.c[7]?.v || '');
        const 렌탈료36 = row.c[14]?.v || '-';
        const 렌탈료48 = row.c[15]?.v || '-';
        const 렌탈료60 = row.c[16]?.v || '-';
        const 정책36 = row.c[20]?.v || '-';
        const 정책48 = row.c[21]?.v || '-';
        const 정책60 = row.c[22]?.v || '-';
        const CRMurl = sanitizeURL(row.c[11]?.v || '');

        const matchesKeyword = 상품명.toLowerCase().includes(keyword) || 모델명.toLowerCase().includes(keyword);
        if (!matchesKeyword) return;

        const card = `<div class="card">
          <img class="thumb" src="${썸네일URL}" alt="이미지">
          <div class="info">
            <div class="title">${상품명}</div>
            <div class="model">모델명: ${모델명}</div>
            <div class="rent">월렌탈료: 36개월 ${렌탈료36} / 48개월 ${렌탈료48} / 60개월 ${렌탈료60}</div>
            <div class="policy">정책: 36개월 ${정책36} / 48개월 ${정책48} / 60개월 ${정책60}</div>
            <a class="crm-link" href="${CRMurl}" target="_blank">CRM 바로가기</a>
          </div>
        </div>`;
        resultDiv.append(card);
      });
    }

    function fetchData() {
      $.ajax({
        url,
        dataType: 'text'
      }).done(response => {
        const json = JSON.parse(response.substring(47).slice(0, -2));
        drawTable(json);
      });
    }
  </script>
</body>
</html>